<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <title>Getting Started: Serving Web Content</title>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-uWxY/CJNBR+1zjPWmfnSnVxwRheevXITnMqoEIeG1LJrdI0GlVs/9cVSyPYXdcSF" crossorigin="anonymous">
  <link rel="stylesheet" href="/css/style.css">
  <script>
      $(document).ready(function() {
          $(".showSortedBybtn").click(function () {
              $(".dropDown-show").toggle();
          });
          $(".search-string").keydown(function (event) {
              event.which(13)
          });

          $("td.status").click(function () {
              var point = $(this).text();
              var taskId = $(this).parent().get(0).id;
              console.log(taskId);
              if (point == "TODO") {
                  $.ajax({
                      type: "POST",
                      url: "/show-tasks/task/update/" + taskId,
                      contentType: "text/plain",
                      data: "IN_PROGRESS",
                      dataType: "json",
                      success: function (data, status) {
                          console.log("Good: " + status);
                          $(this).text(data.status);
                      }
                  });
              } else if (point == "IN_PROGRESS") {
                  $.ajax({
                      type: "POST",
                      url: "/show-tasks/task/update/" + taskId,
                      contentType: "text/plain",
                      data: "COMPLETE",
                      dataType: "json",
                      success: function (data, status) {
                          console.log("Good: " + status);
                          $(this).text(data.status);
                      }
                  });
              } else {
                  $.ajax({
                      type: "POST",
                      url: "/show-tasks/task/update/" + taskId,
                      contentType: "text/plain",
                      data: "TODO",
                      dataType: "json",
                      success: function (data, status) {
                          console.log("Good: " + status);
                          $(this).text(data.status);
                      }
                  });
              }
          });
      });
  </script>
</head>
<body>
<div class="toolbar-container">
  <div class="toolbar">
    <div class="logo">
      <a href="/index">
        <img src="/img/site-icon.ico">
      </a>
    </div>
    <nav class="site-menu">
      <ul class="toolbar-links">
        <li><a href="/create-task">Create task</a></li>
        <li><a href="/show-tasks/page/1">Show tasks</a></li>
        <li class="search-li-element"><a class="search-tag-link" href=""><img class="search-button" src="/img/search-white.png"></a></li>
        <li>
          <form method="get" th:action="@{/show-tasks/page/1}">
            <input type="text" class="search-string" name="searchBy" placeholder="Search...">
          </form>
        </li>
      </ul>
    </nav>
  </div>
</div>
<div class="main-page">
  <h1 class="show-task-page-name">Show tasks page</h1>

  <div class="sorting-div">
    <button class="showSortedBybtn" type="button">Sort byâ–¼</button>
    <div class="dropDown-show">
      <a th:href="@{${currentPage}}">Name</a>
      <a th:href="@{${currentPage} + '?sortBy=status'}">Status</a>
      <a th:href="@{${currentPage} + '?sortBy=due_date'}">Due date</a>
      <a th:href="@{${currentPage} + '?sortBy=priority'}">Priority</a>
    </div>
  </div>

  <table class="table-list">
    <tr>
      <th>Name</th>
      <th>Status</th>
      <th>Due date</th>
      <th>Priority</th>
      <th>Delete task</th>
    </tr>
    <tr th:id="${task.id}" th:each="task : ${service}">
      <td><a th:href="@{/task/{taskId}(taskId=${task.id})}" th:text="${task.name}">Task name</a></td>
      <td class="status" th:text="${task.status}">Task status</td>
      <td th:text="${task.dueDate}">Task due date</td>
      <td th:text="${task.priority}">Task priority</td>
      <td><a th:href="@{/delete-task/{taskId}(taskId=${task.id})}" onclick="return confirm('Are you sure you want to delete this task')">Delete</a>
      </td>
    </tr>
    <tr th:if="${#lists.isEmpty(service)}">
      <td>Nothing found</td>
    </tr>
  </table>
  <div th:if="${totalPages > 1}">
    <nav aria-label="Page navigation example">
        <ul class="pagination">
          <li th:if="${currentPage != 1}" class="page-item">
            <a class="page-link" th:href="@{${currentPage - 1}(sortBy=${sortBy},searchBy=${searchBy})} ">
              Previous
            </a>
          </li>
          <li th:if="${currentPage == 1}" class="page-item disabled">
            <a class="page-link" th:href="@{${currentPage - 1}(sortBy=${sortBy},searchBy=${searchBy})} ">
              Previous
            </a>
          </li>
          <li th:each="pageNumber: ${#numbers.sequence(1, totalPages)}"
              class="page-item">
            <a class="page-link"
               th:href="@{${pageNumber}(sortBy=${sortBy},searchBy=${searchBy})}">
              [[${pageNumber}]]
            </a>
          </li>
          <li th:if="${currentPage < totalPages}" class="page-item">
            <a class="page-link" th:href="@{${currentPage + 1}(sortBy=${sortBy},searchBy=${searchBy})} ">
              Next
            </a>
          </li>
          <li th:if="${currentPage == totalPages}" class="page-item disabled">
            <a class="page-link" th:href="@{${currentPage + 1}(sortBy=${sortBy},searchBy=${searchBy})} ">
              Next
            </a>
          </li>
      </ul>
    </nav>
  </div>
</div>
</body>
</html>